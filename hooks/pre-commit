#!/bin/bash

echo "Starting pre-commit check..."

echo "Running Prettier check..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "Prettier check failed. Trying to auto-fix..."
  npm run format
  if [ $? -ne 0 ]; then
    echo "Could not auto-fix formatting. Commit aborted."
    exit 1
  fi
  echo "Code formatted successfully."
fi

echo "Running ESLint..."
npx eslint . --ext .ts --fix
if [ $? -ne 0 ]; then 
  echo "ESLint failed, correct your code errors before push."
  exit 1
fi

echo "Running Jest tests..."
npm run test:coverage
if [ $? -ne 0 ]; then 
  echo "Something went wrong with tests. Commit aborted."
  exit 1
fi

echo "All pre-commit checks passed, committing."
exit 0
